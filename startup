
local bin_path = "/terrapin/programs"
local api_path = "/terrapin/apis"

local logfile = assert(fs.open("/terrapin/log.txt", "w"))


function _make_aliases(path)
	-- print("making aliases for : ", path)
	local programs = fs.list(path)
	
	for _, program in ipairs(programs) do
		local full_name = fs.combine(path, program)
		if not fs.isDir(full_name) and string.find(program, ".lua$") then
			local alias = program:sub(1, -5)

			shell.setAlias(alias, full_name)
			shell.setAlias(alias:lower(), full_name)
			logfile.write("added alias : " .. alias .. " (" .. alias:lower() .. ") for : " .. full_name .. "\n")
		end
	end
end

io.write "initialising terrapin APIs ... \n"

-- load require API to allow ondemand loading of APIs
dofile("/terrapin/apis/require.lua")

-- Make aliases for all the programs
_make_aliases(bin_path)

-- try to do autoruns
logfile.write("\n\nStarting autorun ... \n")
if fs.exists("/autorun") and not fs.isDir("/autorun") then
	dofile("/autorun")
end

logfile.write("\n\nInitialisation completed\n")
if turtle then
	io.write("(" .. os.getComputerLabel() .. ") Current fuel level : " .. turtle.getFuelLevel() .. "\n")
end

-- register common aliases
shell.setAlias("dt", "digtunnel")
shell.setAlias("dm", "digmine")
shell.setAlias("cm", "clearmountain")

logfile.close()


